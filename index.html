<html>
<head>
	<style>
	*{padding: 0; margin:0;}
	canvas{ background: #eee; display: block; margin: 0 auto;}
	</style>
</head>
<body>
<canvas id= "myCanvas" width="800" height="600"></canvas>
<script src="keyboard.js"></script>
<script src="characterLibrary.js"></script>
<script src="windows.js"></script>
<script type="text/javascript">
let canvas = document.getElementById("myCanvas");
let ctx = canvas.getContext("2d");
canvas.addEventListener("mousemove", getPosition, false);
canvas.addEventListener("mouseup", getMouseUp, false);
canvas.addEventListener("mousedown", getMouseDown, false);
document.addEventListener("keydown",keyDownHandler, false);
document.addEventListener("keyup",keyUpHandler,false);
ctx.canvas.width  = window.innerWidth;
ctx.canvas.height = window.innerHeight;
//defining any needed variables
let fps = 100;
const wW = window.innerWidth;
const wH = window.innerHeight;
let word = [];
let mouseIsDown = false;
let doubleClick = false;
let mouseX = -1;
let mouseY = -1;
let oldMouseX = -1;
let oldMouseY = -1;

//mouse handler functions
function getPosition(e)
{
	mouseX = e.x - canvas.offsetLeft;
	mouseY = e.y - canvas.offsetTop;
}

function getMouseDown(e)
{
	mouseIsDown = true;
	let oldMouseX = mouseX;
	let oldMouseY = mouseY;
}

function getMouseUp(e)
{
	mouseIsDown = false;
}

//allows for text boxes to work properly
function wrapText(ctx, text, x, y, maxWidth, lineHeight)
{
	if(text != null)
	{
		var words = text.split(' ');
		var line = '';

		for(var n = 0; n < words.length; n++)
		{
			var testLine = line + words[n] + ' ';
			var metrics = ctx.measureText(testLine);
			var testWidth = metrics.width;
			if (testWidth > maxWidth && n > 0)
			{
				ctx.fillText(line, x, y);
				line = words[n] + ' ';
				y += lineHeight;
			}
			else
			{
				line = testLine;
			}
		}
		ctx.fillText(line, x, y);
	}
}

//creates drop down boxes when called
function dropDownBox(cR,cG,cB,rectX,rectY,rectL,rectH,listAmount,text,sub)
{
	makeBoxSame = true;
	ctx.fillStyle = "rgb(" + cR + "," + cG + "," + cB + ")";
	ctx.fillRect(rectX,rectY,rectL,rectH);
	let listPart = 0;
	let tabSize = (rectH / listAmount);
	for(let i = 0; i < listAmount; i++)
	{
		ctx.textAlign = "center";
		ctx.textBaseline = "middle";
		ctx.fillStyle = "rgb(0,0,0)";
		if(sub == false)
		{
			ctx.fillText(text[i].name,rectX+(rectL/2),rectY+listPart+(tabSize/2));
			if(mouseX >= rectX && mouseX <= rectX + rectL && mouseY >= rectY + listPart && mouseY <= rectY + listPart + tabSize)
			{
				ctx.fillStyle = "rgb(" + (cR-20) + "," + (cG-20) + "," + (cB-20) + ")";
				ctx.fillRect(rectX,rectY+listPart,rectL,tabSize);
				ctx.fillStyle = "rgb(0,0,0)";
				ctx.fillText(text[i].name,rectX+(rectL/2),rectY+listPart+(tabSize/2));
				if(mouseIsDown)
				{
					mouseIsDown = false;
					makeListSame = text[i].name;
					makeBoxSame = false;
				}
			}
		}
		if(sub == true)
		{
			ctx.fillText(text[i],rectX+(rectL/2),rectY+listPart+(tabSize/2));
			if(mouseX >= rectX && mouseX <= rectX + rectL && mouseY >= rectY + listPart && mouseY <= rectY + listPart + tabSize)
			{
				ctx.fillStyle = "rgb(" + (cR-20) + "," + (cG-20) + "," + (cB-20) + ")";
				ctx.fillRect(rectX,rectY+listPart,rectL,tabSize);
				ctx.fillStyle = "rgb(0,0,0)";
				ctx.fillText(text[i],rectX+(rectL/2),rectY+listPart+(tabSize/2));
				if(mouseIsDown)
				{
					mouseIsDown = false;
					makeListSame = text[i];
					makeBoxSame = false;
				}
			}
		}
		ctx.textBaseline = "alphabetic"
		listPart += tabSize;
	}
	if(mouseX <= rectX || mouseX >= rectX + rectL || mouseY <= rectY || mouseY >= rectY + rectH)
	{
		makeListSame = "";
		if(mouseIsDown)
		{
			mouseIsDown = false;
			makeBoxSame = false;
		}
	}
}

//saves everything to local storage and sets presets to any null values
function useLocalStorage()
{
	for(let i = 0; i <= 3; i++)
	{
		characters[i].name = localStorage.getItem(JSON.stringify("name"+i));	
		if(characters[i].name == null)
		{
			characters[i].name = "Name";
		}
		characters[i].cClass = localStorage.getItem(JSON.stringify("cClass"+i));
		if(characters[i].cClass == null)
		{
			characters[i].cClass = "Class";
		}
		characters[i].race = localStorage.getItem(JSON.stringify("race"+i));
		if(characters[i].race == null)
		{
			characters[i].race = "Race";
		}
		characters[i].background = localStorage.getItem(JSON.stringify("background"+i));
		if(characters[i].background == null)
		{
			characters[i].background = "Background";
		}
		characters[i].alignment = localStorage.getItem(JSON.stringify("alignment"+i));
		if(characters[i].alignment == null)
		{
			characters[i].alignment = "Alignment";
		}
		characters[i].pName = localStorage.getItem(JSON.stringify("pName"+i));
		if(characters[i].pName == null)
		{
			characters[i].pName = "Player Name";
		}
		characters[i].xp = localStorage.getItem(JSON.stringify("XP"+i));
		if(characters[i].xp == null)
		{
			characters[i].xp = "0";
		}
		characters[i].maxHp = localStorage.getItem(JSON.stringify("maxHP"+i));
		if(characters[i].maxHp == null)
		{
			characters[i].maxHp = "0";
		}
		characters[i].currentHp = localStorage.getItem(JSON.stringify("currentHP"+i));
		if(characters[i].currentHp == null)
		{
			characters[i].currentHp = "0";
		}
		characters[i].ac = localStorage.getItem(JSON.stringify("ac"+i));
		if(characters[i].ac == null)
		{
			characters[i].ac = "10";
		}
		characters[i].str = localStorage.getItem(JSON.stringify("str"+i));
		if(characters[i].str == null)
		{
			characters[i].str = "10";
		}
		characters[i].dex = localStorage.getItem(JSON.stringify("dex"+i));
		if(characters[i].dex == null)
		{
			characters[i].dex = "10";
		}
		characters[i].con = localStorage.getItem(JSON.stringify("con"+i));
		if(characters[i].con == null)
		{
			characters[i].con = "10";
		}
		characters[i].intelligence = localStorage.getItem(JSON.stringify("intelligence"+i));
		if(characters[i].intelligence == null)
		{
			characters[i].intelligence = "10";
		}
		characters[i].wis = localStorage.getItem(JSON.stringify("wis"+i));
		if(characters[i].wis == null)
		{
			characters[i].wis = "10";
		}
		characters[i].cha = localStorage.getItem(JSON.stringify("cha"+i));
		if(characters[i].cha == null)
		{
			characters[i].cha = "10";
		}
		characters[i].prof = localStorage.getItem(JSON.stringify("prof"+i));
		if(characters[i].prof == null)
		{
			characters[i].prof = "2";
		}
		characters[i].inspiration = localStorage.getItem(JSON.stringify("inspiration"+i));
		characters[i].deathSaveS1 = localStorage.getItem(JSON.stringify("deathSaveS1"+i));
		characters[i].deathSaveS2 = localStorage.getItem(JSON.stringify("deathSaveS2"+i));
		characters[i].deathSaveS3 = localStorage.getItem(JSON.stringify("deathSaveS3"+i));
		characters[i].deathSaveF1 = localStorage.getItem(JSON.stringify("deathSaveF1"+i));
		characters[i].deathSaveF2 = localStorage.getItem(JSON.stringify("deathSaveF2"+i));
		characters[i].deathSaveF3 = localStorage.getItem(JSON.stringify("deathSaveF3"+i));
		proficiencies[i].strProf = localStorage.getItem(JSON.stringify("strProf"+i));
		proficiencies[i].dexProf = localStorage.getItem(JSON.stringify("dexProf"+i));
		proficiencies[i].conProf = localStorage.getItem(JSON.stringify("conProf"+i));
		proficiencies[i].intProf = localStorage.getItem(JSON.stringify("intProf"+i));
		proficiencies[i].wisProf = localStorage.getItem(JSON.stringify("wisProf"+i));
		proficiencies[i].chaProf = localStorage.getItem(JSON.stringify("chaProf"+i));
		proficiencies[i].acrobaticsProf = localStorage.getItem(JSON.stringify("acrobaticsProf"+i));
		proficiencies[i].animalProf = localStorage.getItem(JSON.stringify("animalProf"+i));
		proficiencies[i].arcanaProf = localStorage.getItem(JSON.stringify("arcanaProf"+i));
		proficiencies[i].athleticsProf = localStorage.getItem(JSON.stringify("athleticsProf"+i));
		proficiencies[i].deceptionProf = localStorage.getItem(JSON.stringify("deceptionProf"+i));
		proficiencies[i].historyProf = localStorage.getItem(JSON.stringify("historyProf"+i));
		proficiencies[i].insightProf = localStorage.getItem(JSON.stringify("insightProf"+i));
		proficiencies[i].intimidationProf = localStorage.getItem(JSON.stringify("intimidationProf"+i));
		proficiencies[i].investigationProf = localStorage.getItem(JSON.stringify("investigationProf"+i));
		proficiencies[i].medicineProf = localStorage.getItem(JSON.stringify("medicineProf"+i));
		proficiencies[i].natureProf = localStorage.getItem(JSON.stringify("natureProf"+i));
		proficiencies[i].perceptionProf = localStorage.getItem(JSON.stringify("perceptionProf"+i));
		proficiencies[i].performanceProf = localStorage.getItem(JSON.stringify("performanceProf"+i));
		proficiencies[i].persuasionProf = localStorage.getItem(JSON.stringify("persuasionProf"+i));
		proficiencies[i].religionProf = localStorage.getItem(JSON.stringify("religionProf"+i));
		proficiencies[i].sleightProf = localStorage.getItem(JSON.stringify("sleightProf"+i));
		proficiencies[i].stealthProf = localStorage.getItem(JSON.stringify("stealthProf"+i));
		proficiencies[i].survivalProf = localStorage.getItem(JSON.stringify("survivalProf"+i));
		proficiencies[i].other = localStorage.getItem(JSON.stringify("otherProf"+i));
		if(characters[i].other == null)
		{
			characters[i].other = "";
		}
		characters[i].equipment = localStorage.getItem(JSON.stringify("equipment"+i));
		if(characters[i].equipment == null)
		{
			characters[i].equipment = "";
		}
		characters[i].cp = localStorage.getItem(JSON.stringify("cp"+i));
		if(characters[i].cp == null)
		{
			characters[i].cp = "0";
		}
		characters[i].sp = localStorage.getItem(JSON.stringify("sp"+i));
		if(characters[i].sp == null)
		{
			characters[i].sp = "0";
		}
		characters[i].gp = localStorage.getItem(JSON.stringify("gp"+i));
		if(characters[i].gp == null)
		{
			characters[i].gp = "0";
		}
		characters[i].ep = localStorage.getItem(JSON.stringify("ep"+i));
		if(characters[i].ep == null)
		{
			characters[i].ep = "0";
		}
		characters[i].pp = localStorage.getItem(JSON.stringify("pp"+i));
		if(characters[i].pp == null)
		{
			characters[i].pp = "0";
		}
		characters[i].pTraits = localStorage.getItem(JSON.stringify("pTraits"+i));
		if(characters[i].pTraits == null)
		{
			characters[i].pTraits = "";
		}
		characters[i].ideals = localStorage.getItem(JSON.stringify("ideals"+i));
		if(characters[i].ideals == null)
		{
			characters[i].ideals = "";
		}
		characters[i].bonds = localStorage.getItem(JSON.stringify("bonds"+i));
		if(characters[i].bonds == null)
		{
			characters[i].bonds = "";
		}
		characters[i].flaws = localStorage.getItem(JSON.stringify("flaws"+i));
		if(characters[i].flaws == null)
		{
			characters[i].flaws = "";
		}
		characters[i].traits = localStorage.getItem(JSON.stringify("traits"+i));
		if(characters[i].traits == null)
		{
			characters[i].traits = "";
		}
		characters[i].tHP = localStorage.getItem(JSON.stringify("tHP"+i));
		if(characters[i].tHP == null)
		{
			characters[i].tHP = "0";
		}
		characters[i].speed = localStorage.getItem(JSON.stringify("speed"+i));
		if(characters[i].speed == null)
		{
			characters[i].speed = "30 ft";
		}
		equipment[i].n1 = localStorage.getItem(JSON.stringify("n1"+i));
		if(equipment[i].n1 == null)
		{
			equipment[i].n1 = "";
		}
		equipment[i].n2 = localStorage.getItem(JSON.stringify("n2"+i));
		if(equipment[i].n2 == null)
		{
			equipment[i].n2 = "";
		}
		equipment[i].n3 = localStorage.getItem(JSON.stringify("n3"+i));
		if(equipment[i].n3 == null)
		{
			equipment[i].n3 = "";
		}
		equipment[i].b1 = localStorage.getItem(JSON.stringify("b1"+i));
		if(equipment[i].b1 == null)
		{
			equipment[i].b1 = "";
		}
		equipment[i].b2 = localStorage.getItem(JSON.stringify("b2"+i));
		if(equipment[i].b2 == null)
		{
			equipment[i].b2 = "";
		}
		equipment[i].b3 = localStorage.getItem(JSON.stringify("b3"+i));
		if(equipment[i].b3 == null)
		{
			equipment[i].b3 = "";
		}
		equipment[i].d1 = localStorage.getItem(JSON.stringify("d1"+i));
		if(equipment[i].d1 == null)
		{
			equipment[i].d1 = "";
		}
		equipment[i].d2 = localStorage.getItem(JSON.stringify("d2"+i));
		if(equipment[i].d2 == null)
		{
			equipment[i].d2 = "";
		}
		equipment[i].d3 = localStorage.getItem(JSON.stringify("d3"+i));
		if(equipment[i].d3 == null)
		{
			equipment[i].d3 = "";
		}
		equipment[i].details = localStorage.getItem(JSON.stringify("details"+i));
		if(equipment[i].details == null)
		{
			equipment[i].details = "";
		}
		characters[i].tHitDice = localStorage.getItem(JSON.stringify("tHitDice"+i));
		if(characters[i].tHitDice == null)
		{
			characters[i].tHitDice = "";
		}
		characters[i].cHitDice = localStorage.getItem(JSON.stringify("cHitDice"+i));
		if(characters[i].cHitDice == null)
		{
			characters[i].cHitDice = "";
		}
		characters[i].subrace = localStorage.getItem(JSON.stringify("subrace"+i));
		if(characters[i].subrace == null)
		{
			characters[i].subrace = "Subrace";
		}
		characters[i].subclass = localStorage.getItem(JSON.stringify("subclass"+i));
		if(characters[i].subclass == null)
		{
			characters[i].subclass = "Subclass";
		}
	}
}

//draws all other functions
function draw()
{
	setTimeout(function()
	{
		requestAnimationFrame(draw);
		ctx.clearRect(0,0,wW,wH);
		///all code goes here
		mouseTimer++;
		drawIcons();
		drawWindows();
		openWindows();
		useLocalStorage();
		if(mouseIsDown)
		{
			oldMouseX = mouseX;
			oldMouseY = mouseY;
		}
	}, 1000/fps);
}
draw();


//this is just a reminder for me on how to open PDFs
//window.open("pdf url here", '_blank');

</script>
</body>
</html>